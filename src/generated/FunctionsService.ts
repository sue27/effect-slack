/**
 * Generated Slack Functions Service
 * DO NOT EDIT - This file is auto-generated by scripts/generate-services.ts
 */

import { Effect } from "effect"
import type {
  FunctionsCompleteErrorArguments,
  FunctionsCompleteErrorResponse,
  FunctionsCompleteSuccessArguments,
  FunctionsCompleteSuccessResponse
} from "@slack/web-api"
import { SlackClient } from "../SlackClient.js"
import { mapSlackError, annotateSpanWithError, type SlackError } from "../internal/errors.js"

export class FunctionsService extends Effect.Service<FunctionsService>()("effect-slack/FunctionsService", {
  effect: Effect.gen(function* () {
    const client = yield* SlackClient

    /**
     * Signal the failure to execute a Custom Function.
     */
    const completeError = (
      args: FunctionsCompleteErrorArguments
    ): Effect.Effect<FunctionsCompleteErrorResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.functions.completeError(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("FunctionsService.completeError", {
          attributes: { "slack.method": "functions.completeError" }
        })
      )

    /**
     * Signal the successful completion of a Custom Function.
     */
    const completeSuccess = (
      args: FunctionsCompleteSuccessArguments
    ): Effect.Effect<FunctionsCompleteSuccessResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.functions.completeSuccess(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("FunctionsService.completeSuccess", {
          attributes: { "slack.method": "functions.completeSuccess" }
        })
      )

    return {
      completeError,
      completeSuccess
    } as const
  }),
  dependencies: [SlackClient.Default]
}) {}
