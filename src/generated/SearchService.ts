/**
 * Generated Slack Search Service
 * DO NOT EDIT - This file is auto-generated by scripts/generate-services.ts
 */

import { Effect } from "effect"
import type {
  SearchAllArguments,
  SearchAllResponse,
  SearchFilesArguments,
  SearchFilesResponse,
  SearchMessagesArguments,
  SearchMessagesResponse
} from "@slack/web-api"
import { SlackClient } from "../SlackClient.js"
import { mapSlackError, annotateSpanWithError, type SlackError } from "../internal/errors.js"

export class SearchService extends Effect.Service<SearchService>()("effect-slack/SearchService", {
  effect: Effect.gen(function* () {
    const client = yield* SlackClient

    /**
     * Searches for messages and files matching a query.
     */
    const all = (
      args: SearchAllArguments
    ): Effect.Effect<SearchAllResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.search.all(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("SearchService.all", {
          attributes: { "slack.method": "search.all" }
        })
      )

    /**
     * Searches for files matching a query.
     */
    const files = (
      args: SearchFilesArguments
    ): Effect.Effect<SearchFilesResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.search.files(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("SearchService.files", {
          attributes: { "slack.method": "search.files" }
        })
      )

    /**
     * Searches for messages matching a query.
     */
    const messages = (
      args: SearchMessagesArguments
    ): Effect.Effect<SearchMessagesResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.search.messages(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("SearchService.messages", {
          attributes: { "slack.method": "search.messages" }
        })
      )

    return {
      all,
      files,
      messages
    } as const
  }),
  dependencies: [SlackClient.Default]
}) {}
