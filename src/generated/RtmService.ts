/**
 * Generated Slack Rtm Service
 * DO NOT EDIT - This file is auto-generated by scripts/generate-services.ts
 */

import { Effect } from "effect"
import type {
  RTMConnectArguments,
  RTMStartArguments,
  RtmConnectResponse,
  RtmStartResponse
} from "@slack/web-api"
import { SlackClient } from "../SlackClient.js"
import { mapSlackError, annotateSpanWithError, type SlackError } from "../internal/errors.js"

export class RtmService extends Effect.Service<RtmService>()("effect-slack/RtmService", {
  effect: Effect.gen(function* () {
    const client = yield* SlackClient

    /**
     * Starts a Real Time Messaging session.
     */
    const connect = (
      args?: RTMConnectArguments
    ): Effect.Effect<RtmConnectResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.rtm.connect(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("RtmService.connect", {
          attributes: { "slack.method": "rtm.connect" }
        })
      )

    /**
     * Starts a Real Time Messaging session.
     * @deprecated
     */
    const start = (
      args?: RTMStartArguments
    ): Effect.Effect<RtmStartResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.rtm.start(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("RtmService.start", {
          attributes: { "slack.method": "rtm.start" }
        })
      )

    return {
      connect,
      start
    } as const
  }),
  dependencies: [SlackClient.Default]
}) {}
