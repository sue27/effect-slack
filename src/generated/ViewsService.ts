/**
 * Generated Slack Views Service
 * DO NOT EDIT - This file is auto-generated by scripts/generate-services.ts
 */

import { Effect } from "effect"
import type {
  ViewsOpenArguments,
  ViewsOpenResponse,
  ViewsPublishArguments,
  ViewsPublishResponse,
  ViewsPushArguments,
  ViewsPushResponse,
  ViewsUpdateArguments,
  ViewsUpdateResponse
} from "@slack/web-api"
import { SlackClient } from "../SlackClient.js"
import { mapSlackError, annotateSpanWithError, type SlackError } from "../internal/errors.js"

export class ViewsService extends Effect.Service<ViewsService>()("effect-slack/ViewsService", {
  effect: Effect.gen(function* () {
    const client = yield* SlackClient

    /**
     * Open a view for a user.
     */
    const open = (
      args: ViewsOpenArguments
    ): Effect.Effect<ViewsOpenResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.views.open(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("ViewsService.open", {
          attributes: { "slack.method": "views.open" }
        })
      )

    /**
     * Publish a static view for a user.
     */
    const publish = (
      args: ViewsPublishArguments
    ): Effect.Effect<ViewsPublishResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.views.publish(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("ViewsService.publish", {
          attributes: { "slack.method": "views.publish" }
        })
      )

    /**
     * Push a view onto the stack of a root view.
     */
    const push = (
      args: ViewsPushArguments
    ): Effect.Effect<ViewsPushResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.views.push(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("ViewsService.push", {
          attributes: { "slack.method": "views.push" }
        })
      )

    /**
     * Update an existing view.
     */
    const update = (
      args: ViewsUpdateArguments
    ): Effect.Effect<ViewsUpdateResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.views.update(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("ViewsService.update", {
          attributes: { "slack.method": "views.update" }
        })
      )

    return {
      open,
      publish,
      push,
      update
    } as const
  }),
  dependencies: [SlackClient.Default]
}) {}
