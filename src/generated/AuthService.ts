/**
 * Generated Slack Auth Service
 * DO NOT EDIT - This file is auto-generated by scripts/generate-services.ts
 */

import { Effect } from "effect"
import type {
  AuthRevokeArguments,
  AuthRevokeResponse,
  AuthTeamsListArguments,
  AuthTeamsListResponse,
  AuthTestArguments,
  AuthTestResponse
} from "@slack/web-api"
import { SlackClient } from "../SlackClient.js"
import { mapSlackError, annotateSpanWithError, type SlackError } from "../internal/errors.js"

export class AuthService extends Effect.Service<AuthService>()("effect-slack/AuthService", {
  effect: Effect.gen(function* () {
    const client = yield* SlackClient

    /**
     * Revokes a token.
     */
    const revoke = (
      args?: AuthRevokeArguments
    ): Effect.Effect<AuthRevokeResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.auth.revoke(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("AuthService.revoke", {
          attributes: { "slack.method": "auth.revoke" }
        })
      )

    const test = (
      args?: AuthTestArguments
    ): Effect.Effect<AuthTestResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.auth.test(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("AuthService.test", {
          attributes: { "slack.method": "auth.test" }
        })
      )

    /**
     * Obtain a full list of workspaces your org-wide app has been approved for.
     */
    const TeamsList = (
      args?: AuthTeamsListArguments
    ): Effect.Effect<AuthTeamsListResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.auth.teams.list(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("AuthService.teams.list", {
          attributes: { "slack.method": "auth.teams.list" }
        })
      )

    return {
      revoke,
      test,
      teams: {
        list: TeamsList
      }
    } as const
  }),
  dependencies: [SlackClient.Default]
}) {}
