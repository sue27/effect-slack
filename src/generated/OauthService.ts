/**
 * Generated Slack Oauth Service
 * DO NOT EDIT - This file is auto-generated by scripts/generate-services.ts
 */

import { Effect } from "effect"
import type {
  OAuthAccessArguments,
  OAuthV2AccessArguments,
  OAuthV2ExchangeArguments,
  OauthAccessResponse,
  OauthV2AccessResponse,
  OauthV2ExchangeResponse
} from "@slack/web-api"
import { SlackClient } from "../SlackClient.js"
import { mapSlackError, annotateSpanWithError, type SlackError } from "../internal/errors.js"

export class OauthService extends Effect.Service<OauthService>()("effect-slack/OauthService", {
  effect: Effect.gen(function* () {
    const client = yield* SlackClient

    /**
     * Exchanges a temporary OAuth verifier code for an access token.
     * @deprecated
     */
    const access = (
      args: OAuthAccessArguments
    ): Effect.Effect<OauthAccessResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.oauth.access(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("OauthService.access", {
          attributes: { "slack.method": "oauth.access" }
        })
      )

    /**
     * Exchanges a temporary OAuth verifier code for an access token.
     */
    const V2Access = (
      args: OAuthV2AccessArguments
    ): Effect.Effect<OauthV2AccessResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.oauth.v2.access(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("OauthService.v2.access", {
          attributes: { "slack.method": "oauth.v2.access" }
        })
      )

    /**
     * Exchanges a legacy access token for a new expiring access token and refresh token.
     */
    const V2Exchange = (
      args: OAuthV2ExchangeArguments
    ): Effect.Effect<OauthV2ExchangeResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.oauth.v2.exchange(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("OauthService.v2.exchange", {
          attributes: { "slack.method": "oauth.v2.exchange" }
        })
      )

    return {
      access,
      v2: {
        access: V2Access,
        exchange: V2Exchange
      }
    } as const
  }),
  dependencies: [SlackClient.Default]
}) {}
