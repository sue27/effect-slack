/**
 * Generated Slack Openid Service
 * DO NOT EDIT - This file is auto-generated by scripts/generate-services.ts
 */

import { Effect } from "effect"
import type {
  OpenIDConnectTokenArguments,
  OpenIDConnectTokenResponse,
  OpenIDConnectUserInfoArguments,
  OpenIDConnectUserInfoResponse
} from "@slack/web-api"
import { SlackClient } from "../SlackClient.js"
import { mapSlackError, annotateSpanWithError, type SlackError } from "../internal/errors.js"

export class OpenidService extends Effect.Service<OpenidService>()("effect-slack/OpenidService", {
  effect: Effect.gen(function* () {
    const client = yield* SlackClient

    /**
     * Exchanges a temporary OAuth verifier code for an access token for {@link https://docs.slack.dev/authentication/sign-in-with-slack Sign in with Slack}.
     */
    const ConnectToken = (
      args: OpenIDConnectTokenArguments
    ): Effect.Effect<OpenIDConnectTokenResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.openid.connect.token(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("OpenidService.connect.token", {
          attributes: { "slack.method": "openid.connect.token" }
        })
      )

    /**
     * Get the identity of a user who has authorized {@link https://docs.slack.dev/authentication/sign-in-with-slack Sign in with Slack}.
     */
    const ConnectUserInfo = (
      args?: OpenIDConnectUserInfoArguments
    ): Effect.Effect<OpenIDConnectUserInfoResponse, SlackError> =>
      Effect.tryPromise({
        try: () => client.openid.connect.userInfo(args),
        catch: mapSlackError
      }).pipe(
        Effect.tapError(annotateSpanWithError),
        Effect.withSpan("OpenidService.connect.userInfo", {
          attributes: { "slack.method": "openid.connect.userInfo" }
        })
      )

    return {
      connect: {
        token: ConnectToken,
        userInfo: ConnectUserInfo
      }
    } as const
  }),
  dependencies: [SlackClient.Default]
}) {}
